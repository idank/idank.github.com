<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
  <link href='http://fonts.googleapis.com/css?family=Cantarell' rel='stylesheet' type='text/css'>
  <meta http-equiv="X-UA-Compatible" content="">
  <title>sub-second precision is not enough - aleph.nu</title>
  <meta name="description" content="">
  <meta name="author" content="Idan Kamara">

    <link rel="shortcut icon" href="/favicon.png">
  
    <link rel="stylesheet" href="/media/css/site.css">
  
      </head>
<body id="sub-second-precision-not-enough">
  <div id="container">
            <div id="header">
          <img src="/media/images/aleph.png" height="120"/>
                      <ul id="navigation">
                          <li>
                <a title="Home Page" class="" href="/">
                    Home
                </a>
              </li>              <li>
                <a title="University" class="" href="/university.html">
                    University
                </a>
              </li>              <li>
                <a title="About" class="" href="/about.html">
                    About
                </a>
              </li>            </ul>          <div><h2 id="site-title"><span>Aleph.Nu</span><span id="title-suffix">ll</span></h2></div>
      </div> <!--! end of #header -->
                  <div class="content">
          <div class="title">
                <h2>sub-second precision is not enough</h2>
    
    <ul class="footer">
            <li class="tags">
            <ul>
                            <li>
                    <a class="small" href="/blog/tags/gsoc.html">gsoc</a>
                </li>
                            <li>
                    <a class="small" href="/blog/tags/mercurial.html">mercurial</a>
                </li>
                        </ul>
        </li>
                    <li class="date"><abbr class="timeago" title="2011-06-04 11:37:00">04 Jun 2011</abbr>, 04 Jun 2011
</li>
    </ul>
</div>

<p>Turns out relying on st_mtime having sub-second precision is not reliable enough, as this small test&nbsp;demonstrates:</p>
<pre><code class="bash">$ touch a b ; stat a b | grep Modify
Modify: 2011-07-28 15:36:19.505160175 +0300
Modify: 2011-07-28 15:36:19.505160175 +0300
</code></pre>

<p>Opening one more process seems to delay enough to show a&nbsp;difference:</p>
<pre><code class="bash">$ touch a ; touch b ; stat a b | grep Modify
Modify: 2011-07-28 15:37:50.082659665 +0300
Modify: 2011-07-28 15:37:50.085158931 +0300
</code></pre>

<p>(test was done on a Debian Squeeze, ext4&nbsp;fs).</p>
<p>Not to mention that Python&#8217;s underlying type for floats is only good for around sixteen digits. Taking out the ten digits before the decimal point, that leaves about six for&nbsp;sub-seconds.</p>
<p>This&nbsp;test:</p>
<pre><code class="python">import os

diffs = 0

for i in range(10000):
    f = open('x', 'w+')
    f.close()

    one = os.stat('x').st_mtime

    f = open('x', 'w+')
    f.close()

    two = os.stat('x').st_mtime

    if one != two:
        diffs += 1

print diffs, 'diffs out of 10000 iterations'
</code></pre>

<p>is giving me around ~30 per run, which is obviously not good&nbsp;enough.</p>      </div>
      </div> <!--! end of #container -->
  <div id="footer">
  </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.js"></script>
  <script>window.jQuery || document.write('<script src="/media/js/libs/jquery-1.5.1.min.js">\x3C/script>')</script>
  <script src="/media/js/libs/jquery.timeago.js" type="text/javascript"></script>
  <script>
      jQuery(document).ready(function() {
        jQuery("abbr.timeago").timeago();
      });
  </script>
    <script src="/media/js/libs/highlight.pack.js" type="text/javascript"></script>
<script type="text/javascript">
        hljs.initHighlightingOnLoad();
</script>
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-28052058-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
    </body>
</html>